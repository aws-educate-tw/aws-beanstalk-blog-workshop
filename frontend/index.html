<!DOCTYPE html>
<html>

<head>
    <title>My Blog</title>
    <meta charset="UTF-8">

    <script>
        BASE_URL = 'PutYourAPIURLHere';
    </script>

    <!-- Google font -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web:400,400i,600,600i,700,700i,900">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,600,600i,700,700i,800,800i">
    <!-- Bootstrap -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
    <!-- icofont -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionic/1.3.2/css/ionic.css">
    <!-- carousel -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.carousel.min.css">
    <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/assets/owl.theme.default.css">

    <style>
        body {
            overflow-y: auto;
        }

        .blog_section {
            max-height: 100vh;
            overflow-y: auto;
            padding-bottom: 3rem;
        }

        form {
            max-width: 600px;
            width: 100%;
            padding: 20px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 8px;
        }

        input,
        textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 16px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        input[type="file"] {
            margin-bottom: 8px;
        }

        button {
            background-color: #007bff;
            color: #fff;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <section class="blog_section">
        <div class="px-4 py-4 my-5 text-center">
            <img class="d-block mx-auto mb-4" src="blogging.png" alt="" width="72" height="57">
            <h1 class="display-5 fw-bold text-body-emphasis"> My Blog</h1>
            <!-- <div class="col-lg-6 mx-auto">
              <p class="lead mb-4">Quickly design and customize responsive mobile-first sites with Bootstrap, the world’s most popular front-end open source toolkit, featuring Sass variables and mixins, responsive grid system, extensive prebuilt components, and powerful JavaScript plugins.</p>
            </div> -->
        </div>

        <div class="container">
            <div class="blog_content">
                <div class="owl-carousel owl-theme">
                    
                </div>
            </div>
        </div>

        <div class="container" style="margin-top: 60px;display: flex;justify-content: center;">
            <!-- <div class="card"> -->
                <form id="BlogForm">
                    <label for="poster">姓名:</label>
                    <textarea id="poster" name="poster" rows="1" required></textarea>
                
                    <label for="title">標題:</label>
                    <textarea id="title" name="title" rows="1" required></textarea>
                
                    <label for="content">文章:</label>
                    <textarea id="content" name="content" rows="4" required></textarea>
                
                    <label for="image">上傳圖片:</label>
                    <input type="file" id="image" name="image" accept="image/*" required>
                
                    <hr>
                    <button type="submit">提交</button>
                </form>
            <!-- </div> -->
        </div>
    </section>

    <!-- Jquery -->
    <script src="https://code.jquery.com/jquery-3.3.1.js"></script>
    <!-- bootstrap -->
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.0/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
    <!-- carousel -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.js"></script>
    
    <!-- credit: https://bootsnipp.com/snippets/NAjW6 -->

    <script src="index.js"></script>
    <link rel="stylesheet" href="styles.css">

    <script>
        $(document).ready(function () {
            // Fetch and display dynamic blog content
            $.ajax({
                url: BASE_URL+'/api/articles',
                type: 'GET',
                dataType: 'json',
                success: function (data) {
                    displayBlogContent(data);
                },
                error: function(xhr, status, error) {
                    var err = eval("(" + xhr.responseText + ")");
                   console.log(err.Message);
                }
            });
        });

        function displayBlogContent(data) {
            var blogContainer = [];

            data.forEach(function (item) {
                var blogItem = $('<div class="blog_item">');
                blogItem.html(`

                    <div class="blog_item">
                        <div class="blog_image">
                            <img class="img-fluid"
                                src="${item.imageUrl}"
                                alt="images not found">
                            <span><i class="icon ion-md-create"></i></span>
                        </div>
                        <div class="blog_details">
                            <div class="blog_title">
                                <h5><a href="#">${item.title}</a></h5>
                            </div>
                            <ul>
                                <li><i class="icon ion-md-person"></i>${item.poster}</li>
                                <li><i class="icon ion-md-calendar"></i>${item.createAt}</li>
                            </ul>
                            <p>${item.content}</p>
                        </div>
                    </div>

                `);

                blogContainer.push(blogItem);
            });
                
                
            var enableAutoplay = data.length >= 3;
            var page_item = 3;
            var page_center = false;
            if (data.length == 1) {
                page_item = 3;
                page_center = true;
            }else if(data.length == 2){
                page_item = 2;
                page_center = false;
            }

            $('.owl-carousel').owlCarousel('destroy').owlCarousel({
                loop: false,
                rewind: true,
                margin: 10,
                center: page_center, // Center the single item
                autoplay: enableAutoplay, // Enable autoplay
                autoplayTimeout: 3000, // Set autoplay interval in milliseconds (adjust as needed)
                responsive:{
                    0:{
                        items:page_item,
                        nav:false
                    }
                }              
            })
         
            blogContainer.forEach(function (item) {
                $('.owl-carousel').trigger('add.owl.carousel', item);
            });

            $('.owl-carousel').trigger('refresh.owl.carousel');
        }
        

        $('#BlogForm').submit(function (event) {
            event.preventDefault();
            alert("上傳中...");

            var formData = new FormData(this);

            // Construct JSON object
            var jsonData = {
                poster: $('#poster').val(),
                title: $('#title').val(),
                content: $('#content').val(),
            };

            // Convert JSON object to a FormData object
            var jsonFormData = new FormData();
            jsonFormData.append('data', JSON.stringify(jsonData));

            // Append the image file to the FormData object
            jsonFormData.append('image', formData.get('image'));

            $.ajax({
                url: BASE_URL+'/api/articles',
                type: 'POST',
                data: jsonFormData,
                processData: false, // important
                contentType: false, // important
                success: function (response) {
                    console.log('Form submitted successfully:', response);
                    location.reload();
                },
                error: function(xhr, status, error) {
                    var err = eval("(" + xhr.responseText + ")");
                    console.log(err.Message);
                }
            });
        });
    </script>

</body>

</html>



